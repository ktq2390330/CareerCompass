<!-- base.htmlを継承 -->
{% extends "adm_base.html" %}

<!-- staticタグを使うために追加 -->
{% load static %}

<!-- top page用のタイトル -->
{% block title %}adm_post{% endblock %}

<!-- top page用のcssを読み込む -->
{% block head %}
    <link href="{% static 'css/adm_post.css' %}" rel="stylesheet">
{% endblock %}

<!-- base.htmlにぶち込む部分 -->
{% block content %}
<h1>新しい求人を作成</h1>
<form method="post" enctype="multipart/form-data">
    {% csrf_token %}
    {{ form.as_p }}

    <script>
        // カテゴリ00選択時にカテゴリ01を動的に更新
        document.getElementById('id_category00').addEventListener('change', function() {
            const category00Id = this.value;
            fetch(`/get_category01/${category00Id}/`)
                .then(response => response.json())
                .then(data => {
                    const category01Select = document.getElementById('id_category01');
                    category01Select.innerHTML = '';
                    const defaultOption = document.createElement('option');
                    defaultOption.textContent = 'カテゴリ01を選択してください';
                    defaultOption.value = '';
                    category01Select.appendChild(defaultOption);
                    data.category01.forEach(category => {
                        const option = document.createElement('option');
                        option.value = category.id;
                        option.textContent = category.name;
                        category01Select.appendChild(option);
                    });
                });
        });

        // カテゴリ10選択時にカテゴリ11を動的に更新
        document.getElementById('id_category10').addEventListener('change', function() {
            const category10Id = this.value;
            fetch(`/get_category11/${category10Id}/`)
                .then(response => response.json())
                .then(data => {
                    const category11Select = document.getElementById('id_category11');
                    category11Select.innerHTML = '';
                    const defaultOption = document.createElement('option');
                    defaultOption.textContent = 'カテゴリ11を選択してください';
                    defaultOption.value = '';
                    category11Select.appendChild(defaultOption);
                    data.category11.forEach(category => {
                        const option = document.createElement('option');
                        option.value = category.id;
                        option.textContent = category.name;
                        category11Select.appendChild(option);
                    });
                });
        });

        // エリア選択時に都道府県名を更新
        document.getElementById('id_area1').addEventListener('change', function() {
            const area1Id = this.value;
            fetch(`/get_area/${area1Id}/`)
                .then(response => response.json())
                .then(data => {
                    const areaSelect = document.getElementById('id_area1');
                    areaSelect.innerHTML = '';
                    const defaultOption = document.createElement('option');
                    defaultOption.textContent = data.area;  // 都道府県名
                    defaultOption.value = area1Id;
                    areaSelect.appendChild(defaultOption);
                });
        });
    </script>

    <button type="submit">求人投稿</button>
</form>
{% endblock %}