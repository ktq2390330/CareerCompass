{% extends "base.html" %}

{% load static %}

{% block title %}プロフィール{% endblock %}

{% block head %}
<link href="{% static 'css/profile.css' %}" rel="stylesheet">
<script>
    document.addEventListener("DOMContentLoaded", function() {
        const photoInput = document.querySelector("#id_photo"); // ファイル入力フィールド
        const previewImage = document.querySelector("#preview-image"); // プレビュー画像

        photoInput.addEventListener("change", function(event) {
            const file = event.target.files[0];
            if (file) {
                const reader = new FileReader();
                reader.onload = function(e) {
                    previewImage.src = e.target.result;
                    previewImage.style.display = "block"; // プレビュー画像を表示
                };
                reader.readAsDataURL(file);
            } else {
                previewImage.style.display = "none"; // ファイルが選択されていない場合非表示
            }
        });
    });
</script>
{% endblock %}

{% block content %}
<div class="container">
    <form action="{% url 'CCapp:profile' %}" method="post" enctype="multipart/form-data">
        {% csrf_token %}
        <div class="profile-box">
            <div class="photo-container">
                <div class="photo-box">
                    <!-- 保存された画像があれば表示、なければ画像アップロードフォームを表示 -->
                    {% if form.instance.photo %}
                        <img id="preview-image" 
                             src="{{ form.instance.photo.url }}" 
                             alt="プロフィール写真" 
                             style="max-width: 200px; max-height: 200px; display: block;" />
                    {% else %}
                        <img id="preview-image" 
                             src="#" 
                             alt="プロフィール写真" 
                             style="display: none; max-width: 200px; max-height: 200px;" />
                    {% endif %}
                    <!-- 画像アップロード用のフォーム -->
                    {{ form.photo }}  
                </div>
            </div>
            <div class="form-group">
                <label for="furigana">氏名(カナ)</label>
                {{ form.furigana }}
            </div>
            <div class="form-group">
                <label for="birth">生年月日</label>
                {{ form.birth }}
            </div>
            <div class="form-group">
                <label for="gender">性別</label>
                {{ form.gender }}
            </div>
            <div class="form-group">
                <label for="postalCode">郵便番号</label>
                {{ form.postalCode }}
            </div>
            <div class="form-group">
                <label for="uAddress">住所</label>
                {{ form.uAddress }}
            </div>
            <div class="form-group">
                <label for="uTel">電話番号</label>
                {{ form.uTel }}
            </div>
            <div class="form-group">
                <label for="uSchool">学校名</label>
                {{ form.uSchool }}
            </div>
            <div class="form-group">
                <label for="graduation">卒業年度</label>
                {{ form.graduation }}
            </div>
            <div class="button-group">
                <button type="submit" name="save" class="btn btn-primary">保存</button>
            </div>
        </div>
    </form>
</div>
{% endblock %}
