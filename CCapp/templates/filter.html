{% extends "base.html" %}

{% load static %}

{% block title %}Filter Unified{% endblock %}

{% block head %}
<link href="{% static 'css/filter.css' %}" rel="stylesheet">
{% endblock %}

{% block content %}
<div class="container">
    <div class="search-field">
        <form method="GET" action="{% url 'CCapp:offer_search' %}" id="filterForm">
            <input type="text" name="name" placeholder="企業名や業種で探す">
            <button type="submit" class="search-button">検索</button>

            <!-- 大分類ボタン -->
            <nav class="filter-navigation">
                <ul class="filter-navigation-button">
                    <li><a href="javascript:void(0);" onclick="switchFilter('area')">エリア</a></li>
                    <li><a href="javascript:void(0);" onclick="switchFilter('industry')">業界</a></li>
                    <li><a href="javascript:void(0);" onclick="switchFilter('jobtype')">職種</a></li>
                    <li><a href="javascript:void(0);" onclick="switchFilter('benefits')">福利厚生</a></li>
                </ul>
            </nav>
  <!-- 中分類 (エリアの地方ボタン) -->
            <nav class="area-navigation filter-section" id="area" style="display: none;">
                <ul class="region-button">
                    {% for area in area0_list %}
                    <li>
                        <a href="javascript:void(0);" onclick="showSubcategories('area{{ area.id }}')">
                            {{ area.name }}
                        </a>
                    </li>
                    {% endfor %}
                </ul>

                <!-- エリアのチェックボックス -->
                {% for area in area0_list %}
                <div id="area{{ area.id }}" class="subcategory-section" style="display: none;">
                    {% for region in area1_list %}
                    {% if region.area0_id == area.id %}
                    <div class="prefecture-checkboxes">
                        <label>
                            <input type="checkbox" name="area1" value="{{ region.id }}">
                            {{ region.name }}
                        </label><br>
                    </div>
                    {% endif %}
                    {% endfor %}
                </div>
                {% endfor %}
            </nav>

            <!-- 中分類 (業界のカテゴリボタン) -->
            <nav class="industry-navigation filter-section" id="industry" style="display: none;">
                <ul class="industry-button">
                    {% for industry in category00_list %}
                    <li>
                        <a href="javascript:void(0);" onclick="showSubcategories('industry{{ industry.id }}')">
                            {{ industry.name }}
                        </a>
                    </li>
                    {% endfor %}
                </ul>

                <!-- 業界のチェックボックス -->
                {% for industry in category00_list %}
                <div id="industry{{ industry.id }}" class="subcategory-section" style="display: none;">
                    {% for category in category01_list %}
                    {% if category.category00_id == industry.id %}
                    <div class="industry-checkboxes">
                        <label>
                            <input type="checkbox" name="category01" value="{{ category.id }}">
                            {{ category.name }}
                        </label><br>
                    </div>
                    {% endif %}
                    {% endfor %}
                </div>
                {% endfor %}
            </nav>

            <!-- 中分類 (職種のカテゴリボタン) -->
            <nav class="jobtype-navigation filter-section" id="jobtype" style="display: none;">
                <ul class="jobtype-button">
                    {% for jobtype in category10_list %}
                    <li>
                        <a href="javascript:void(0);" onclick="showSubcategories('jobtype{{ jobtype.id }}')">
                            {{ jobtype.name }}
                        </a>
                    </li>
                    {% endfor %}
                </ul>

                <!-- 職種のチェックボックス -->
                {% for jobtype in category10_list %}
                <div id="jobtype{{ jobtype.id }}" class="subcategory-section" style="display: none;">
                    {% for category in category11_list %}
                    {% if category.category10_id == jobtype.id %}
                    <div class="jobtype-checkboxes">
                        <label>
                            <input type="checkbox" name="category11" value="{{ category.id }}">
                            {{ category.name }}
                        </label><br>
                    </div>
                    {% endif %}
                    {% endfor %}
                </div>
                {% endfor %}
            </nav>

            <!-- 中分類 (福利厚生のタグボタン) -->
            <nav class="benefits-navigation filter-section" id="benefits" style="display: none;">
                <ul class="benefits-button">
                    <li>
                        <a href="javascript:void(0);" onclick="showBenefitsSubcategories()">
                            福利厚生
                        </a>
                    </li>
                </ul>

                <!-- 福利厚生のチェックボックス -->
                <div id="benefits-checkboxes" class="subcategory-section" style="display: none;">
                    {% for tag in tag_list %}
                    <div class="benefits-checkboxes">
                        <label>
                            <input type="checkbox" name="tag" value="{{ tag.id }}">
                            {{ tag.name }}
                        </label><br>
                    </div>
                    {% endfor %}
                </div>
            </nav>

            <button type="submit" class="search-button">検索</button>
        </form>
    </div>
</div>

<script>
    // 大分類の切り替え
    function switchFilter(filterType) {
        // すべての中分類を非表示にする
        document.querySelectorAll('.filter-section').forEach(section => {
            section.style.display = 'none';
        });

        // 選択された大分類の中分類を表示
        let selectedSection = document.getElementById(filterType);
        if (selectedSection) {
            selectedSection.style.display = 'block';
        }

        // 大分類に対応する最初の中分類を表示
        let firstSubcategory = document.querySelector(`#${filterType} .subcategory-section`);
        if (firstSubcategory) {
            firstSubcategory.style.display = 'block';
        }

        // 'active' クラスを削除
        const allButtons = document.querySelectorAll('.filter-navigation-button a');
        allButtons.forEach(button => button.classList.remove('active'));

        // クリックしたボタンに 'active' クラスを追加
        const clickedButton = document.querySelector(`.filter-navigation-button a[onclick="switchFilter('${filterType}')"]`);
        if (clickedButton) {
            clickedButton.classList.add('active');
        }
    }

    // 中分類の選択時に該当するチェックボックスを表示
    function showSubcategories(subcategoryId) {
        // すべてのチェックボックスを非表示にする
        document.querySelectorAll('.subcategory-section').forEach(section => {
            section.style.display = 'none';
        });

        let selectedSubcategory = document.getElementById(subcategoryId);
        if (selectedSubcategory) {
            selectedSubcategory.style.display = 'block';
        }

        // 中分類が表示されたら、その中のチェックボックスを表示する
        let checkboxes = selectedSubcategory.querySelectorAll('div');
        checkboxes.forEach(checkbox => {
            checkbox.style.display = 'block';
        });
    }

    // 福利厚生のチェックボックスの表示/非表示
    function showBenefitsSubcategories() {
        document.querySelectorAll('.subcategory-section').forEach(section => {
            section.style.display = 'none';
        });

        let benefitsSection = document.getElementById('benefits-checkboxes');
        if (benefitsSection) {
            benefitsSection.style.display = 'block';
        }

        // チェックボックスを表示
        let checkboxes = benefitsSection.querySelectorAll('div');
        checkboxes.forEach(checkbox => {
            checkbox.style.display = 'block';
        });
    }

    // ページロード時の初期化
    window.onload = function() {
        // エリアの中分類（北海道地方）を最初に表示
        let areaSection = document.getElementById('area');
        if (areaSection) {
            areaSection.style.display = 'block';
        }

        // 最初のエリア中分類（北海道）を表示
        let firstAreaSubcategory = document.querySelector('#area .subcategory-section');
        if (firstAreaSubcategory) {
            firstAreaSubcategory.style.display = 'block';
        }

        // 最初のボタンをアクティブにする
        const firstButton = document.querySelector('.filter-navigation-button a');
        if (firstButton) {
            firstButton.classList.add('active');
        }
    };
</script>

{% endblock %}
